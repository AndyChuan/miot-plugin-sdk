'use strict';var e=require("@babel/runtime/helpers/interopRequireDefault")(require("@babel/runtime/helpers/extends")),r=require('commander'),i=require('path'),o=require("fs"),n=require("pump"),t=require('compressing'),s=require("./config/common"),a=s.project_dir,c=s.process_dir,l=s.API_LEVEL,p=s.SDK_VERSION,g=s.makeDirsSync,u=require('./run-eslint').fix;function d(){if((r.args||[]).length<1)return r.outputHelp(),void process.exit(1001);var s=r.args[0],p=i.join(a,"projects",s),u=i.join(p,"project.json"),d=!(!r.target||!r.target.length)&&r.target,f=i.join(p,"build"),h=d?i.isAbsolute(d)?d:i.join(c,d):i.join(f,"publish");if(g(i.dirname(h)),g(i.dirname(f)),!o.existsSync(p)||!o.existsSync(u))return console.log("invalid package path"),void process.exit(1002);var v=JSON.parse(o.readFileSync(u).toString());if(v.package_path==s){v=(0,e.default)(v,{min_sdk_api_level:l,package_path:s,version_code:parseInt(v.version_code||"0"),entrance_scene:v.entrance_scene||{}}),console.log(v),v=Buffer.from(JSON.stringify(v));var j=h.endsWith(".mpkg")?h:h+".mpkg";console.log("Ready to create publish package file:"),console.log(i.relative(c,j));var m=new t.zip.Stream,S=i.join(f,"project.json");o.writeFileSync(S,v),m.addEntry(S),o.readdirSync(p).forEach(function(e){if(e&&""!=e&&"build"!=e&&"project.json"!=e&&!e.startsWith(".")){var r=i.join(p,e);console.log("compressing:"+e),m.addEntry(r)}}),n(m,o.createWriteStream(j),function(e){e&&console.log("failed to create publish file",e),e||(console.log("Publish package file for publish is generated:"),console.log(j))})}else console.log("invalid package path in project.json")}r.version("version:"+p).usage("<packageName>").option("-t, --target [dir]","\u8f93\u51fa\u7684\u76ee\u6807\u6587\u4ef6\u5939","").description("\u6253\u6210\u53d1\u5e03\u5305").parse(process.argv);try{!(function(){if((r.args||[]).length<1)return r.outputHelp(),void process.exit(1001);var e=r.args[0],n=i.join(a,"projects",e);if(!o.existsSync(n))return console.log("invalid package path"),void process.exit(1002);u([n]).then(function(){console.log('eslint fix report'),d()}).catch(function(){d()})})()}catch(e){console.log(e)}